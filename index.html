<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SCFHS Classroom Rationale Engine - Level 4</title>
<style>
body { font-family: Arial, sans-serif; background:#f4f6f8; margin:0; padding:0; }
.container { max-width:1000px; margin:auto; background:#fff; padding:25px; border-radius:8px; box-shadow:0 0px 10px rgba(0,0,0,0.1); }
h2 { text-align:center; margin-bottom:20px; }
.option { margin:10px 0; padding:12px; border:1px solid #ccc; border-radius:6px; cursor:pointer; }
.option:hover { background:#f0f8ff; }
.correct { background:#d4edda; border-color:#28a745; }
.incorrect { background:#f8d7da; border-color:#dc3545; }
.hidden { display:none; }
.review { margin-top:20px; padding:15px; background:#f9fafb; border-left:5px solid #007bff; }
.tag { font-size:12px; padding:2px 6px; border-radius:4px; margin-left:6px; }
.SCFHS { background:#d4edda; }
.NCLEX { background:#cce5ff; }
.STR { background:#fff3cd; }
.SAFE_DELAY { background:#e2e3e5; }
.progress-container { width:100%; background:#e2e3e5; border-radius:5px; overflow:hidden; margin-bottom:20px; }
.progress-bar { height:20px; width:0%; background:#007bff; color:#fff; text-align:center; line-height:20px; }
</style>
</head>

<body>
<div class="container">
<h2>SCFHS Classroom Rationale Engine - Level 4</h2>

<button id="startBtn">Start Quiz</button>
<div id="quiz" class="hidden"></div>
<div id="review" class="review hidden"></div>
<button onclick="nextQuestion()" id="nextBtn" class="hidden">Next Question</button>

<div class="progress-container">
  <div class="progress-bar" id="progressBar">0%</div>
</div>
</div>

<script>
// ================================
// QUESTIONS
// ================================
const questions = [
{
  q: "When a nurse places a febrile infant into cold water, how is heat primarily lost?",
  options: [
    { text: "Evaporation", tag: "SAFE_DELAY" },
    { text: "Convection", tag: "NCLEX" },
    { text: "Conduction", tag: "SCFHS" },
    { text: "Radiation", tag: "STR" }
  ],
  correctTag: "SCFHS",
  mechanism: "heatTransfer.conduction"
},
{
  q: "A patient on isolation coughs into the air repeatedly. Nurse technician must:",
  options: [
    { text: "Ensure proper mask and hand hygiene", tag: "SCFHS" },
    { text: "Tell patient it’s not important", tag: "STR" },
    { text: "Ignore if symptoms mild", tag: "SAFE_DELAY" },
    { text: "Move patient to hallway", tag: "NCLEX" }
  ],
  correctTag: "SCFHS",
  mechanism: "infection.isolation"
}
];

// ================================
// RATIONALE LIBRARY (FIXED)
// ================================
const rationaleLibrary = {
heatTransfer: {
  conduction: {
    correct: "Direct contact transfers heat from warm skin to cold water.",
    distractors: {
      SAFE_DELAY: "Evaporation requires vaporization.",
      NCLEX: "Convection involves moving fluids.",
      STR: "Radiation requires no contact."
    },
    exam: "Conduction = direct contact",
    patho: "Thermal gradient causes heat loss",
    intuitive: "Touch ice → conduction"
  }
},
infection: {
  isolation: {
    correct: "Proper PPE prevents transmission.",
    distractors: {
      STR: "Ignoring spreads infection.",
      SAFE_DELAY: "Delay risks exposure.",
      NCLEX: "Hallway breaks isolation."
    },
    exam: "Isolation → PPE",
    patho: "Droplet spread",
    intuitive: "Mask + hygiene"
  }
}
};

// ================================
// ENGINE
// ================================
let index = 0;

document.getElementById("startBtn").onclick = () => {
  document.getElementById("startBtn").classList.add("hidden");
  document.getElementById("quiz").classList.remove("hidden");
  renderQuestion();
};

function renderQuestion() {
  const q = questions[index];
  const quiz = document.getElementById("quiz");
  const review = document.getElementById("review");
  review.classList.add("hidden");
  document.getElementById("nextBtn").classList.add("hidden");

  quiz.innerHTML = `<b>Question ${index+1}:</b><br>${q.q}`;

  q.options.forEach((o,i)=>{
    const div = document.createElement("div");
    div.className = "option";
    div.innerHTML = `${String.fromCharCode(65+i)}. ${o.text} <span class="tag ${o.tag}">${o.tag}</span>`;
    div.onclick = () => selectAnswer(o.tag);
    quiz.appendChild(div);
  });

  updateProgress();
}

function selectAnswer(tag) {
  const q = questions[index];
  const review = document.getElementById("review");
  review.classList.remove("hidden");

  const [g,k] = q.mechanism.split(".");
  const mech = rationaleLibrary[g][k];

  document.querySelectorAll(".option").forEach(o=>{
    o.classList.add(o.innerHTML.includes(q.correctTag) ? "correct" : "incorrect");
    o.style.pointerEvents = "none";
  });

  review.innerHTML = `<b>Correct:</b> ${mech.correct}`;
  document.getElementById("nextBtn").classList.remove("hidden");
}

function nextQuestion(){
  index++;
  if(index >= questions.length){
    document.getElementById("quiz").innerHTML = "<h3>End of Quiz</h3>";
    document.getElementById("nextBtn").classList.add("hidden");
    return;
  }
  renderQuestion();
}

function updateProgress(){
  const percent = Math.round(((index+1)/questions.length)*100);
  const bar = document.getElementById("progressBar");
  bar.style.width = percent+"%";
  bar.innerText = percent+"%";
}
</script>
</body>
</html>
